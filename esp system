getgenv().ESP = {
    Enabled = false,
    TeamCheck = true,
    MaxDistance = 2000,
    FontSize = 13,
    FadeOut = {
        OnDistance = true,
        OnDeath = true,
        OnLeave = true,
    },
    Drawing = {
        Chams = {
            Enabled = true,
            Thermal = true,
            FillRGB = Color3.fromRGB(119, 120, 255),
            Fill_Transparency = 100,
            OutlineRGB = Color3.fromRGB(119, 120, 255),
            Outline_Transparency = 100,
            VisibleCheck = true,
        },
        Names = {
            Enabled = true,
            RGB = Color3.fromRGB(255, 255, 255),
        },
        Distances = {
            Enabled = true,
            Position = "Text",
            RGB = Color3.fromRGB(255, 255, 255),
        },
        Healthbar = {
            Enabled = true,
            HealthText = true,
            Width = 2.5,
            GradientRGB1 = Color3.fromRGB(200, 0, 0),
            GradientRGB2 = Color3.fromRGB(60, 60, 125),
            GradientRGB3 = Color3.fromRGB(119, 120, 255),
        },
        Boxes = {
            Enabled = true,
            Filled = {
                Enabled = true,
                Transparency = 0.75,
                RGB = Color3.fromRGB(0, 0, 0),
            },
            Full = {
                Enabled = true,
                RGB = Color3.fromRGB(255, 255, 255),
            },
            Corner = {
                Enabled = true,
                RGB = Color3.fromRGB(255, 255, 255),
            }
        }
    }
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local function CreateESP(player)
    local ESP = Instance.new("Folder")
    ESP.Name = player.Name .. "_ESP"
    
    local Box = Instance.new("BoxHandleAdornment")
    Box.Name = "Box"
    Box.Size = Vector3.new(4, 5, 1)
    Box.Color3 = ESP.Drawing.Boxes.Full.RGB
    Box.Transparency = 0.5
    Box.ZIndex = 10
    Box.AlwaysOnTop = true
    Box.Visible = ESP.Drawing.Boxes.Enabled
    Box.Adornee = player.Character
    Box.Parent = ESP

    local Chams = Instance.new("Highlight")
    Chams.Name = "Chams"
    Chams.FillColor = ESP.Drawing.Chams.FillRGB
    Chams.OutlineColor = ESP.Drawing.Chams.OutlineRGB
    Chams.FillTransparency = ESP.Drawing.Chams.Fill_Transparency/100
    Chams.OutlineTransparency = ESP.Drawing.Chams.Outline_Transparency/100
    Chams.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    Chams.Parent = player.Character

    local BillboardGui = Instance.new("BillboardGui")
    BillboardGui.Name = "ESP_GUI"
    BillboardGui.AlwaysOnTop = true
    BillboardGui.Size = UDim2.new(0, 200, 0, 50)
    BillboardGui.StudsOffset = Vector3.new(0, 3, 0)
    BillboardGui.Parent = player.Character:WaitForChild("Head")

    local Name = Instance.new("TextLabel")
    Name.Name = "Name"
    Name.BackgroundTransparency = 1
    Name.Size = UDim2.new(1, 0, 0, 20)
    Name.Text = player.Name
    Name.TextColor3 = ESP.Drawing.Names.RGB
    Name.TextSize = ESP.FontSize
    Name.Font = Enum.Font.Code
    Name.Parent = BillboardGui

    RunService.RenderStepped:Connect(function()
        if not ESP.Enabled then
            Box.Visible = false
            Chams.Enabled = false
            BillboardGui.Enabled = false
            return
        end

        if ESP.TeamCheck and player.Team == LocalPlayer.Team then
            Box.Visible = false
            Chams.Enabled = false
            BillboardGui.Enabled = false
            return
        end

        local distance = (Camera.CFrame.Position - player.Character.HumanoidRootPart.Position).Magnitude
        if distance > ESP.MaxDistance then
            Box.Visible = false
            Chams.Enabled = false
            BillboardGui.Enabled = false
            return
        end

        Box.Visible = ESP.Drawing.Boxes.Enabled
        Chams.Enabled = ESP.Drawing.Chams.Enabled
        BillboardGui.Enabled = ESP.Drawing.Names.Enabled
    end)
end

for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    local esp = workspace:FindFirstChild(player.Name .. "_ESP")
    if esp then
        esp:Destroy()
    end
end)
